> *When I am working on a problem, I never think about beauty. But when I have finished, if the solution is not beautiful, I know it is wrong.* - R. Buckminster Fuller (1895â€“1993)
## Code Generation
- The goal is to convert high level language understood by humans, into low level code understood by computers

### Handling Variables
- All primitive types are 16 bit, so each variable is 1 *word* long
- Static variables should exist only once during the entirety of the program's life
- Field variables should exist for each object and only during that object's life cycle
- Subroutine variables should exist for each time the routine is called and then freed after it ends
	- All of these are handled with the VM memory segments - `static, local, argument, this, that`
- Managed using a symbol table

#### Symbol Table
- When the compiler encounters a variable in a high level statement, it needs to know what memory segment it should belong to and what it represents

```
let y = foo(x)

- static, field, local?
- int, boolean, char, object?
```

- These properties can easily be managed using a **symbol table**
- When a variable is declared in the source code, the compiler allocates the needed VM memory segment and records this mapping in the symbol table
	- Whenever a variable is encountered, it's properties are retrieved from this table or if it doesn't exist yet, is added to it
- These variables can exist in multiple scopes and in which they can possess different properties
	- Static and field variables are scoped to the class in which they are declared
	- Local and arg variables are scoped to the subroutine in which they are declared
	- This is achieved using a symbol table for each scope

![](Images/Pasted%20image%2020231010055227.png)

- Scopes are nested, with inner scopes hiding outer ones
	- Variables are searched outwards and if not found, are added to the symbol table in the current scope
- Jack only has two scopes, the subroutine level and the class level, and therefore, only two symbol tables

#### Variable Declarations
1. **Compiler Start for Class Declaration**:
   - Create class-level symbol table.
   - Create subroutine-level symbol table.

1. **On Parsing `static` or `field` Variable**:
   - Add to class-level table.
   - Record: variable name, type, kind (`static` or `field`), and index within kind.
   
3. **On Starting Subroutine Compilation**:
   - Reset subroutine-level table.
   - If subroutine is a method:
	 - Add row `<this, className, arg, 0>` to subroutine-level table.

1. **On Parsing `local` or `argument` Variable**:
   - Add to subroutine-level table.
   - Record: variable name, type, kind (`var` or `arg`), and index within kind.
   
5. **Indexing**:
   - Start index for each kind (`var` or `arg`) at 0.
   - Increment by 1 for each new variable of that kind added.
