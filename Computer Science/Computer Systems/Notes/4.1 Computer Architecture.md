## Fundamentals

### Stored Program Concept
- A fixed hardware platform capable of executing a fixed set of simple instructions which exist temporarily in memory
- This means the platform can behave differently each time it is loaded with a new program

### Von Neumann Architecture
- A CPU interacting with memory, receiving data from an input and emitting to some output
- Memory stores not only the manipulated data, but the instructions that tell the computer what to do

![[figure_5.1.png]]

### Memory
- Linear sequence of addressable, fixed size registers each having a unique address and a value
- Stores data and instructions as sequences of bits
#### Data Memory
- Abstractions such as variables, arrays and objects are are just binary values stored in registers
- To read a register, supply an address and probe the value of the address
- To write to a register, supply an address and store a new value in the register, overriding the previous value

#### Instruction Memory
- High level code must first be translated into machine code, written as binary values inside a *binary* or *executable* version of the program

### CPU
- Executes instructions of the current program
	- Each instruction tells the CPU which computation to perform, which registers to access and which instruction to fetch and execute next
	- Achieved using Arithmetic Logic Unit, a set of registers and a control unit

#### ALU
- Performs low level arithmetic and logic operations
- Adds two given values, computer their bitwise AND, compare them for equality, etc

#### Registers:
- CPU needs to store temporary values with short distances from ALU (memory units not suitable for this reason, otherwise cause starvation)
	- Include a small set of high speed registers
	- Data registers to store values that are used to address the RAM
	- Program counter register stores the address of the next instruction
	- Instruction register stores the current instruction

#### Control
- Instructions need to be decoded into micro codes which are then routed to its designated hardware device, where it tells the CPU how to use to do the instruction

### Input & Output
- All input devices are treated the same via memory-mapped IO
	- This is basically a binary emulation of the I/O device, making it appear to the CPU as if it were regular memory segment
- For each device, a designated area in the memory has a dedicated memory map
	- For example, a keyboard memory map tracks what keys are pressed in binary
- These maps are refreshed many times per second

## Hack Specification

- A Von Neumann machine consisting of a CPU, two separate memory modules for instructions and data, and two memory mapped IO devices - a screen and keyboard
	- CPU consists of the ALU, data, address and program counter registers
- Executes programs that reside in instruction memory
	- A instructions, 16 bits of instruction are loaded into the A register
	- C instructions, split into various bits that are sent to different parts of the CPU


### CPU
- Executes 16 bit instructions according to hack machine language
- Consists of ALU, A and D registers, program counter
- Connects to instruction memory to fetch instructions for execution
- Connects to data memory to read and write data values
	- `inM` and `outM` hold the values referred to as `M` in the hack syntax
	- `addressM` holds the address at which `outM` should be written

![[figure_5.2.png]]

- A instruction
	- CPU loads the 16 bit value into the A register
- C instruction
	- CPU causes the ALU to perform the computation specified by instruction and stores in `A, D, M` registers
	- If one of the destination registers is `M`, `outM` is set to the ALU output, and `writeM` becomes 1 (meaning its allowed to write)
- If reset == 1, then PC jumps to 0

### Instruction Memory

![[figure_5.3.png]]

### I/O
- Access to I/O devices made possible by data memory where memory maps are stored
- When one or more bits are changed in a memory map, the change is immediately reflected in whatever medium
- Realised by built in chips called `SCREEN` and `KBD`

#### Screen
- 256 rows of 512 black and white pixels each, spanning a grid of 131,072 pixels
- Computer interfaces with the physical screen via a memory chip, meaning that it can be read and written to using a regular RAM interface
- State of any 1 of its bits is reflected by a pixel on the physical screen `1=black, 0=white`

![[figure_5.4.png]]

#### Keyboard
